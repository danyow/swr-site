---
layout: post
title: 'Python3é¢å‘å¯¹è±¡ç¼–ç¨‹'
categories: ç¬”è®° python
comments: true
date: 2019-05-27 22:33:07 +0800
published: true
---

Title: ç¬¬äºŒç‰ˆ

## 2. Python å¯¹è±¡

* è‡ªæˆ‘è§£é‡Š -> åœ¨è§„èŒƒè‡ªå·±æ‰€ç¼–å†™çš„ç±»çš„æ—¶å€™ï¼Œåº”è¯¥åŠ å…¥è¯¦å°½çš„æ³¨é‡Šã€‚

```python
class Point:
    'è¿™æ®µæ˜¯ç±»æ³¨é‡Šï¼Œå»ºè®®ç”¨å•å¼•å·'

    def __init__(self, x=0, y=0):
        '''å¤šè¡Œæ–‡æ¡£æ³¨é‡Š'''
        pass

    def foo(self):
        'å•è¡Œæ–‡æ¡£æ³¨é‡Š'
        pass
```

* åŒä¸‹åˆ’çº¿çš„å‘½åçš„å˜é‡ï¼Œæ˜¯ä¼šå¯¹å…¶å®æ–½**å‘½åæ”¹è£…**ã€‚ä¼šè‡ªåŠ¨å°è£… _(ç±»å)

## 3. å¯¹è±¡ç›¸ä¼¼æ—¶

* å¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†å¤šä¸ªç±»ï¼Œé‚£ä¹ˆåœ¨åˆå§‹åŒ–å…¶çˆ¶ç±»æ—¶ï¼Œå¯ä»¥é‡‡ç”¨å¦‚ä¸‹æ–¹å¼ã€‚

```python
# åˆ†åˆ«è°ƒç”¨çˆ¶ç±»
class Teacher(Person, Title):
    def __init__(self, name, title, studens):
        Person.__init__(self, name)
        Title.__init__(self, title)
        self.studens = studens

'''
ä»¥ä¸Šå°±æ˜¯ç®€å•å®šä¹‰äº†ä¸€ä¸ªå¤šç»§æ‰¿å…³ç³»çš„ç±»ï¼Œè¿™ä¹ˆçœ‹æ¥æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„
ä½†ä½œè€…æåˆ°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœåœ¨å®šä¹‰æ¨¡å‹çš„æ—¶å€™ï¼Œéœ€è¦è¿æ¥æ•°æ®åº“ï¼Œé‚£ä¹ˆæ¯æ¬¡éƒ½æ˜¯è¿æ¥ä¸¤æ¬¡æ•°æ®åº“ã€‚
è¿™é‡Œå¯ä»¥é‡‡ç”¨ __mro__ æ¥ä¿®æ”¹æ–¹æ³•çš„è°ƒç”¨é¡ºåº
'''

# é‡‡ç”¨super() å’Œ **kw çš„æ–¹å¼

class Person(object):
    def __init__(self, name='', **kw):
        self.name = name

class Title(object):
    def __init__(self, title='', **kw):
        self.title = title

class Teacher(Person, Title):
    def __init__(self, studens=null, **kw):
        super().__init__(**kw)
        self.studens = studens

'''
super() çš„æ–¹å¼å¯ä»¥ç¡®ä¿objectåªåˆå§‹åŒ–ä¸€æ¬¡ã€‚
**kw çš„æ–¹å¼å¯ä»¥è§£å†³å¤šçˆ¶ç±»æƒ…å†µä¸‹ å‚æ•°ä¸ä¸€è‡´çš„é—®é¢˜
'''
```

* å¦‚æœå®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡åŸºç±» `abc` è€Œä¸”è¿™ä¸ªç±»é‡å†™äº† `__subclasshook__(cls, C)` çš„æ—¶å€™ï¼Œéœ€è¦æ³¨æ„

ä»»æ„ç±»çš„å®ä¾‹åœ¨è¢«è°ƒç”¨ `insubclass` å’Œ `ininstance` æ˜¯ä¼šå»è°ƒç”¨æŠ½è±¡åŸºç±»é‡å†™çš„ `__subclasshook__` è¿™ä¸ªæ–¹æ³•çš„ï¼Œå¦‚æœä»–è¯´çš„æ˜¯é‚£ä¹ˆå°±æ˜¯ã€‚

## 4. å¼‚å¸¸æ•è·

* `else` å’Œ `finally` çš„è°ƒç”¨æ˜¯ï¼Œæ²¡æœ‰å¼‚å¸¸æ—¶å‰è€…ä¼šæ‰§è¡Œï¼Œåè€…æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œã€‚

* å¼‚å¸¸çš„å±‚çº§

```python
'''
    BaseException   <---    KeybordInterrupt, SystemExit
                    <---    Exception   <---    å…¶ä»–æ‰€æœ‰çš„å¼‚å¸¸
'''
```

## 6. Python æ•°æ®ç»“æ„

* æ— æ³•ç»™å†…ç½®ç±»å®ä¾‹æ·»åŠ å±æ€§ï¼Œä½†å¯ä»¥ç»™è‡ªå®šä¹‰ç±»æ·»åŠ å±æ€§ã€‚

```python
o = object()
o.x = 0
'''
ğŸ‘†ä¼šæŠ¥é”™
ğŸ‘‡æ­£å¸¸è¿è¡Œ
'''
class MyClass(object):
    pass
m = MyClass()
m.x = 1
```

* å‘½åå…ƒç»„ç›¸å½“äºå­—å…¸

```python
from collections import namedtuple

Stock = namedtuple("Stock", "symbol current high low")
# Stock = namedtuple("Stock", "symbol, current, high, low")
stock = Stock("FB", 75.0, 75.3, 74.2)
# å¯ä»¥ä½¿ç”¨ç‚¹è¯­æ³•
stock.symbol
```

* `total_ordering` å¯¹åº”ç€ `>, <, ==, !=, >=, <=` é€»è¾‘è¿ç®—ç¬¦

* `operator.itemgetter` å¯ä»¥å¯¹å…ƒç»„æ’åºæ—¶ï¼Œç›´æ¥ä¿®æ”¹æ‰€è¦æ¯”è¾ƒæ—¶ç”¨åˆ°çš„æ˜¯ç¬¬å‡ ä¸ªå±æ€§

```python
from operator import itemgetter

l = [('h', 4), ('n', 6), ('o', 5), ('p', 1), ('t', 3), ('y', 2)]
# è¿™é‡Œç›´æ¥é‡‡ç”¨ç¬¬äºŒä¸ªé”®æ¥åšæ¯”è¾ƒçš„é¡¹
l.sort(key=itemgetter(1))
```

* é˜Ÿåˆ—æœ‰ä¸‰ç§

1. FIFO é˜Ÿåˆ—ï¼ˆ*First In First Out*ï¼‰

   `from queue import Queue`

2. LIFO é˜Ÿåˆ—ï¼ˆ*Last In First Out*ï¼‰

    `from queue import LifoQueue`

3. ä¼˜å…ˆçº§é˜Ÿåˆ—

    `from queue import PriorityQueue`

## 7. Python é¢å‘å¯¹è±¡çš„æ·å¾„

* ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œåˆ¤æ–­ä¸€ä¸ªå¯¹è±¡èƒ½å¦æ‰§è¡Œ `with` è¯­å¥ï¼Œå¯ä»¥ç”¨å“ªä¸ª `dir()` æŸ¥çœ‹é‡Œé¢æ˜¯å¦æœ‰ `__ennter__` å’Œ `__exit__`

* å‚æ•°è§£åŒ…ï¼Œå¯¹äºåˆ—è¡¨å¯¹è±¡çš„è§£åŒ…æ˜¯åŠ  `*`, å­—å…¸çš„è§£åŒ…æ˜¯ `**`

## 8. å­—ç¬¦ä¸²ä¸åºåˆ—åŒ–

* å ä½å€¼æ”¹å˜æ‰“å°æ ·å¼

```python
'''
{0:10s}     så­—ç¬¦ä¸²ï¼Œç„¶åæ˜¯å 10ä¸ªå­—èŠ‚ã€‚
{1:^9d}     dæ•´å½¢ï¼Œç„¶åå 9ä¸ªå­—èŠ‚ï¼Œ^(è„±å­—ç¬¦)è¡¨ç¤ºå±…ä¸­å¯¹é½ã€‚
{2:<8.2f}   fæµ®ç‚¹å‹ï¼Œç„¶åå 8ä¸ªå­—èŠ‚ï¼Œ<è¡¨ç¤ºå‘å·¦å¯¹é½ï¼Œ.2çœç•¥ä¸¤ä½å°æ•°
{3:>7.2f}   fæµ®ç‚¹å‹ï¼Œç„¶åå 7ä¸ªå­—èŠ‚ï¼Œ>è¡¨ç¤ºå‘å³å¯¹é½ï¼Œ.2çœç•¥ä¸¤ä½å°æ•°
'''
orders = [('burger', 2, 5),
          ('fries', 3.5, 1),
          ('cola', 1.75, 3)]

print("PRODUCT    QUANTITY   PRICE    SUBTOTAL")

for product, price, quantity in orders:
    subtotal = price * quantity
    print("{0:10s}{1:^9d}   ${2:<8.2f}${3:>7.2f}".format(product, quantity, price, subtotal))

'''
PRODUCT    QUANTITY   PRICE    SUBTOTAL
burger        5       $2.00    $  10.00
fries         1       $3.50    $   3.50
cola          3       $1.75    $   5.25
'''
```

## 9. è¿­ä»£å™¨æ¨¡å¼

* åç¨‹

```python
def tally():
    score = 0
    while True:
        increment = yield score
        print("increment : {}, score : {}".format(increment, score))
        score += increment

white_sox = tally()
next(white_sox)
white_sox.send(3)

'''
increment : 3, score : 0
'''
```

1. `yield` çš„å‡ºç°å’Œç”Ÿæˆå™¨æš‚åœã€‚
2. åœ¨å‡½æ•°å¤–æ‰§è¡Œ `send()` æ–¹æ³•ï¼Œä¸”æ¿€æ´»äº†ç”Ÿæˆå™¨ã€‚
3. å‘é€çš„å€¼èµ‹ç»™äº† `yield` è¯­å¥å·¦ä¾§çš„å˜é‡ã€‚
4. ç”Ÿæˆå™¨ç»§ç»­æ‰§è¡Œï¼Œç›´è‡³é‡åˆ°ä¸‹ä¸€ä¸ª `yield` è¯­å¥ã€‚

## 10. Python è®¾è®¡æ¨¡å¼ I

* è§‚å¯Ÿè€…æ¨¡å¼åœ¨æ‰§è¡Œèµ·æ¥éœ€è¦ä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤

    1. è¢«è§‚å¯Ÿè€…ä¸»åŠ¨é€šçŸ¥è§‚å¯Ÿè€… é€šè¿‡ `_update_observers`

    ```python
    class Inventory:
        def __init__(self):
            self.observers = []

        def _update_observers(self):
            for observer in self.observers:
                observer()
    ```

    1. è§‚å¯Ÿè€…è‡ªèº«ç°å®è¢«è°ƒç”¨æ–¹æ³• é€šè¿‡ `__call__`

    ```python
    class Observer:
        def __init__(self, inventory):
            self.inventory = inventory

        def __call__(self):
            print("è§‚å¯ŸæˆåŠŸï¼")
    ```

## 12. æµ‹è¯•é¢å‘å¯¹è±¡ç¨‹åº

* `unittest` çš„ `setUp()` æ˜¯ç”¨äºæ¯æ¬¡æ‰§è¡Œæµ‹è¯•æ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¯¥æ–¹æ³•ç”¨ä»¥ä¿è¯æ•°æ®è¢«æ±¡æŸ“ å’Œ `tearDown()` æ˜¯ç”¨æ¥ä¿è¯æ¯æ¬¡æµ‹è¯•ç»“æŸåè°ƒç”¨ã€‚

* `py.test` ä¸ä¹‹ç›¸å¯¹åº”çš„æœ‰ç±»ä¼¼å‡ ä¸ªã€‚

  1. `setup_module`
  2. `teardown_module`
  3. `setup_class`
  4. `teardown_class`
  5. `setup_method`
  6. `teardown_method`

* `pytest_funcarg__<idenntifier>` å’Œè¢«æµ‹è¯•å‡½æ•°éœ€è¦æ¥å—çš„å‚æ•°ä½œä¸ºæµ‹è¯•

```python
def pytest_funcarg__numbers(request):
    return [1,2,3]

def test_sum(numbers):
    assert sum(numbers) == 6
```

## 13. å¹¶å‘

* è‡ªå®šä¹‰çº¿ç¨‹å†è¢«éœ€è¦é‡å†™ `run()` æ–¹æ³•ï¼Œä½†è°ƒç”¨æ—¶ç”¨åˆ°çš„æ˜¯ `start()`